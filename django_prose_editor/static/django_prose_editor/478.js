"use strict";let __rslib_import_meta_url__="undefined"==typeof document?new(require("url".replace("",""))).URL("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href;exports.ids=["478"],exports.modules={"./node_modules/@tiptap/extension-table-cell/dist/index.js":function(e,t,l){l.d(t,{p:function(){return n}});var o=l("./node_modules/@tiptap/core/dist/index.js");let n=o.NB.create({name:"tableCell",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{let t=e.getAttribute("colwidth");return t?t.split(",").map(e=>parseInt(e,10)):null}}}),tableRole:"cell",isolating:!0,parseHTML:()=>[{tag:"td"}],renderHTML({HTMLAttributes:e}){return["td",(0,o.P1)(this.options.HTMLAttributes,e),0]}})},"./node_modules/@tiptap/extension-table-header/dist/index.js":function(e,t,l){l.d(t,{x:function(){return n}});var o=l("./node_modules/@tiptap/core/dist/index.js");let n=o.NB.create({name:"tableHeader",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{let t=e.getAttribute("colwidth");return t?t.split(",").map(e=>parseInt(e,10)):null}}}),tableRole:"header_cell",isolating:!0,parseHTML:()=>[{tag:"th"}],renderHTML({HTMLAttributes:e}){return["th",(0,o.P1)(this.options.HTMLAttributes,e),0]}})},"./node_modules/@tiptap/extension-table-row/dist/index.js":function(e,t,l){l.d(t,{S:function(){return n}});var o=l("./node_modules/@tiptap/core/dist/index.js");let n=o.NB.create({name:"tableRow",addOptions:()=>({HTMLAttributes:{}}),content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML:()=>[{tag:"tr"}],renderHTML({HTMLAttributes:e}){return["tr",(0,o.P1)(this.options.HTMLAttributes,e),0]}})},"./node_modules/@tiptap/extension-table/dist/index.js":function(e,t,l){l.d(t,{iA:()=>ep});var o,n,r=l("./node_modules/@tiptap/core/dist/index.js"),i=l("./node_modules/prosemirror-state/dist/index.js"),a=l("./node_modules/prosemirror-model/dist/index.js"),s=l("./node_modules/prosemirror-view/dist/index.js"),d=l("./node_modules/prosemirror-keymap/dist/index.js"),c=l("./node_modules/prosemirror-transform/dist/index.js");if("undefined"!=typeof WeakMap){let e=new WeakMap;o=t=>e.get(t),n=(t,l)=>(e.set(t,l),l)}else{let e=[],t=0;o=t=>{for(let l=0;l<e.length;l+=2)if(e[l]==t)return e[l+1]},n=(l,o)=>(10==t&&(t=0),e[t++]=l,e[t++]=o)}var p=class{constructor(e,t,l,o){this.width=e,this.height=t,this.map=l,this.problems=o}findCell(e){for(let t=0;t<this.map.length;t++){let l=this.map[t];if(l!=e)continue;let o=t%this.width,n=t/this.width|0,r=o+1,i=n+1;for(let e=1;r<this.width&&this.map[t+e]==l;e++)r++;for(let e=1;i<this.height&&this.map[t+this.width*e]==l;e++)i++;return{left:o,top:n,right:r,bottom:i}}throw RangeError(`No cell with offset ${e} found`)}colCount(e){for(let t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw RangeError(`No cell with offset ${e} found`)}nextCell(e,t,l){let{left:o,right:n,top:r,bottom:i}=this.findCell(e);if("horiz"==t)return(l<0?0==o:n==this.width)?null:this.map[r*this.width+(l<0?o-1:n)];return(l<0?0==r:i==this.height)?null:this.map[o+this.width*(l<0?r-1:i)]}rectBetween(e,t){let{left:l,right:o,top:n,bottom:r}=this.findCell(e),{left:i,right:a,top:s,bottom:d}=this.findCell(t);return{left:Math.min(l,i),top:Math.min(n,s),right:Math.max(o,a),bottom:Math.max(r,d)}}cellsInRect(e){let t=[],l={};for(let o=e.top;o<e.bottom;o++)for(let n=e.left;n<e.right;n++){let r=o*this.width+n,i=this.map[r];if(!l[i]){if(l[i]=!0,n==e.left&&n&&this.map[r-1]==i||o==e.top&&o&&this.map[r-this.width]==i)continue;t.push(i)}}return t}positionAt(e,t,l){for(let o=0,n=0;;o++){let r=n+l.child(o).nodeSize;if(o==e){let l=t+e*this.width,o=(e+1)*this.width;for(;l<o&&this.map[l]<n;)l++;return l==o?r-1:this.map[l]}n=r}}static get(e){return o(e)||n(e,function(e){if("table"!=e.type.spec.tableRole)throw RangeError("Not a table node: "+e.type.name);let t=function(e){let t=-1,l=!1;for(let o=0;o<e.childCount;o++){let n=e.child(o),r=0;if(l)for(let t=0;t<o;t++){let l=e.child(t);for(let e=0;e<l.childCount;e++){let n=l.child(e);t+n.attrs.rowspan>o&&(r+=n.attrs.colspan)}}for(let e=0;e<n.childCount;e++){let t=n.child(e);r+=t.attrs.colspan,t.attrs.rowspan>1&&(l=!0)}-1==t?t=r:t!=r&&(t=Math.max(t,r))}return t}(e),l=e.childCount,o=[],n=0,r=null,i=[];for(let e=0,n=t*l;e<n;e++)o[e]=0;for(let a=0,s=0;a<l;a++){let d=e.child(a);s++;for(let e=0;;e++){for(;n<o.length&&0!=o[n];)n++;if(e==d.childCount)break;let c=d.child(e),{colspan:p,rowspan:h,colwidth:u}=c.attrs;for(let e=0;e<h;e++){if(e+a>=l){(r||(r=[])).push({type:"overlong_rowspan",pos:s,n:h-e});break}let d=n+e*t;for(let e=0;e<p;e++){0==o[d+e]?o[d+e]=s:(r||(r=[])).push({type:"collision",row:a,pos:s,n:p-e});let l=u&&u[e];if(l){let o=(d+e)%t*2,n=i[o];null==n||n!=l&&1==i[o+1]?(i[o]=l,i[o+1]=1):n==l&&i[o+1]++}}}n+=p,s+=c.nodeSize}let c=(a+1)*t,p=0;for(;n<c;)0==o[n++]&&p++;p&&(r||(r=[])).push({type:"missing",row:a,n:p}),s++}let a=new p(t,l,o,r),s=!1;for(let e=0;!s&&e<i.length;e+=2)null!=i[e]&&i[e+1]<l&&(s=!0);return s&&function(e,t,l){!e.problems&&(e.problems=[]);let o={};for(let n=0;n<e.map.length;n++){let r=e.map[n];if(o[r])continue;o[r]=!0;let i=l.nodeAt(r);if(!i)throw RangeError(`No cell with offset ${r} found`);let a=null,s=i.attrs;for(let l=0;l<s.colspan;l++){let o=t[2*((n+l)%e.width)];null!=o&&(!s.colwidth||s.colwidth[l]!=o)&&((a||(a=function(e){if(e.colwidth)return e.colwidth.slice();let t=[];for(let l=0;l<e.colspan;l++)t.push(0);return t}(s)))[l]=o)}a&&e.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:a})}}(a,i,e),a}(e))}};function h(e){let t=e.cached.tableNodeTypes;if(!t)for(let l in t=e.cached.tableNodeTypes={},e.nodes){let o=e.nodes[l],n=o.spec.tableRole;n&&(t[n]=o)}return t}var u=new i.H$("selectingCells");function f(e){for(let t=e.depth-1;t>0;t--)if("row"==e.node(t).type.spec.tableRole)return e.node(0).resolve(e.before(t+1));return null}function m(e){let t=e.selection.$head;for(let e=t.depth;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return!0;return!1}function g(e){let t=e.selection;if("$anchorCell"in t&&t.$anchorCell)return t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell;if("node"in t&&t.node&&"cell"==t.node.type.spec.tableRole)return t.$anchor;let l=f(t.$head)||function(e){for(let t=e.nodeAfter,l=e.pos;t;t=t.firstChild,l++){let o=t.type.spec.tableRole;if("cell"==o||"header_cell"==o)return e.doc.resolve(l)}for(let t=e.nodeBefore,l=e.pos;t;t=t.lastChild,l--){let o=t.type.spec.tableRole;if("cell"==o||"header_cell"==o)return e.doc.resolve(l-t.nodeSize)}}(t.$head);if(l)return l;throw RangeError(`No cell found around position ${t.head}`)}function w(e){return"row"==e.parent.type.spec.tableRole&&!!e.nodeAfter}function b(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function C(e,t,l){let o=e.node(-1),n=p.get(o),r=e.start(-1),i=n.nextCell(e.pos-r,t,l);return null==i?null:e.node(0).resolve(r+i)}function v(e,t,l=1){let o={...e,colspan:e.colspan-l};return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(t,l),!o.colwidth.some(e=>e>0)&&(o.colwidth=null)),o}function y(e,t,l=1){let o={...e,colspan:e.colspan+l};if(o.colwidth){o.colwidth=o.colwidth.slice();for(let e=0;e<l;e++)o.colwidth.splice(t,0,0)}return o}var A=class e extends i.Y1{constructor(e,t=e){let l=e.node(-1),o=p.get(l),n=e.start(-1),r=o.rectBetween(e.pos-n,t.pos-n),a=e.node(0),s=o.cellsInRect(r).filter(e=>e!=t.pos-n);s.unshift(t.pos-n);let d=s.map(e=>{let t=l.nodeAt(e);if(!t)throw RangeError(`No cell with offset ${e} found`);let o=n+e+1;return new i.xm(a.resolve(o),a.resolve(o+t.content.size))});super(d[0].$from,d[0].$to,d),this.$anchorCell=e,this.$headCell=t}map(t,l){let o=t.resolve(l.map(this.$anchorCell.pos)),n=t.resolve(l.map(this.$headCell.pos));if(w(o)&&w(n)&&b(o,n)){let t=this.$anchorCell.node(-1)!=o.node(-1);return t&&this.isRowSelection()?e.rowSelection(o,n):t&&this.isColSelection()?e.colSelection(o,n):new e(o,n)}return i.Bs.between(o,n)}content(){let e=this.$anchorCell.node(-1),t=p.get(e),l=this.$anchorCell.start(-1),o=t.rectBetween(this.$anchorCell.pos-l,this.$headCell.pos-l),n={},r=[];for(let l=o.top;l<o.bottom;l++){let i=[];for(let r=l*t.width+o.left,a=o.left;a<o.right;a++,r++){let l=t.map[r];if(n[l])continue;n[l]=!0;let a=t.findCell(l),s=e.nodeAt(l);if(!s)throw RangeError(`No cell with offset ${l} found`);let d=o.left-a.left,c=a.right-o.right;if(d>0||c>0){let e=s.attrs;if(d>0&&(e=v(e,0,d)),c>0&&(e=v(e,e.colspan-c,c)),a.left<o.left){if(!(s=s.type.createAndFill(e)))throw RangeError(`Could not create cell with attrs ${JSON.stringify(e)}`)}else s=s.type.create(e,s.content)}if(a.top<o.top||a.bottom>o.bottom){let e={...s.attrs,rowspan:Math.min(a.bottom,o.bottom)-Math.max(a.top,o.top)};s=a.top<o.top?s.type.createAndFill(e):s.type.create(e,s.content)}i.push(s)}r.push(e.child(l).copy(a.HY.from(i)))}let i=this.isColSelection()&&this.isRowSelection()?e:r;return new a.p2(a.HY.from(i),1,1)}replace(e,t=a.p2.empty){let l=e.steps.length,o=this.ranges;for(let n=0;n<o.length;n++){let{$from:r,$to:i}=o[n],s=e.mapping.slice(l);e.replace(s.map(r.pos),s.map(i.pos),n?a.p2.empty:t)}let n=i.Y1.findFrom(e.doc.resolve(e.mapping.slice(l).map(this.to)),-1);n&&e.setSelection(n)}replaceWith(e,t){this.replace(e,new a.p2(a.HY.from(t),0,0))}forEachCell(e){let t=this.$anchorCell.node(-1),l=p.get(t),o=this.$anchorCell.start(-1),n=l.cellsInRect(l.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o));for(let l=0;l<n.length;l++)e(t.nodeAt(n[l]),o+n[l])}isColSelection(){let e=this.$anchorCell.index(-1),t=this.$headCell.index(-1);if(Math.min(e,t)>0)return!1;let l=e+this.$anchorCell.nodeAfter.attrs.rowspan;return Math.max(l,t+this.$headCell.nodeAfter.attrs.rowspan)==this.$headCell.node(-1).childCount}static colSelection(t,l=t){let o=t.node(-1),n=p.get(o),r=t.start(-1),i=n.findCell(t.pos-r),a=n.findCell(l.pos-r),s=t.node(0);return i.top<=a.top?(i.top>0&&(t=s.resolve(r+n.map[i.left])),a.bottom<n.height&&(l=s.resolve(r+n.map[n.width*(n.height-1)+a.right-1]))):(a.top>0&&(l=s.resolve(r+n.map[a.left])),i.bottom<n.height&&(t=s.resolve(r+n.map[n.width*(n.height-1)+i.right-1]))),new e(t,l)}isRowSelection(){let e=this.$anchorCell.node(-1),t=p.get(e),l=this.$anchorCell.start(-1),o=t.colCount(this.$anchorCell.pos-l),n=t.colCount(this.$headCell.pos-l);if(Math.min(o,n)>0)return!1;let r=o+this.$anchorCell.nodeAfter.attrs.colspan;return Math.max(r,n+this.$headCell.nodeAfter.attrs.colspan)==t.width}eq(t){return t instanceof e&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,l=t){let o=t.node(-1),n=p.get(o),r=t.start(-1),i=n.findCell(t.pos-r),a=n.findCell(l.pos-r),s=t.node(0);return i.left<=a.left?(i.left>0&&(t=s.resolve(r+n.map[i.top*n.width])),a.right<n.width&&(l=s.resolve(r+n.map[n.width*(a.top+1)-1]))):(a.left>0&&(l=s.resolve(r+n.map[a.top*n.width])),i.right<n.width&&(t=s.resolve(r+n.map[n.width*(i.top+1)-1]))),new e(t,l)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,l){return new e(t.resolve(l.anchor),t.resolve(l.head))}static create(t,l,o=l){return new e(t.resolve(l),t.resolve(o))}getBookmark(){return new S(this.$anchorCell.pos,this.$headCell.pos)}};A.prototype.visible=!1,i.Y1.jsonID("cell",A);var S=class e{constructor(e,t){this.anchor=e,this.head=t}map(t){return new e(t.map(this.anchor),t.map(this.head))}resolve(e){let t=e.resolve(this.anchor),l=e.resolve(this.head);return"row"==t.parent.type.spec.tableRole&&"row"==l.parent.type.spec.tableRole&&t.index()<t.parent.childCount&&l.index()<l.parent.childCount&&b(t,l)?new A(t,l):i.Y1.near(l,1)}};function $(e){if(!(e.selection instanceof A))return null;let t=[];return e.selection.forEachCell((e,l)=>{t.push(s.p.node(l,l+e.nodeSize,{class:"selectedCell"}))}),s.EH.create(e.doc,t)}var M=new i.H$("fix-tables");function x(e,t){let l;let o=(t,o)=>{"table"==t.type.spec.tableRole&&(l=function(e,t,l,o){let n,r;let i=p.get(t);if(!i.problems)return o;!o&&(o=e.tr);let a=[];for(let e=0;e<i.height;e++)a.push(0);for(let e=0;e<i.problems.length;e++){let n=i.problems[e];if("collision"==n.type){let e=t.nodeAt(n.pos);if(!e)continue;let r=e.attrs;for(let e=0;e<r.rowspan;e++)a[n.row+e]+=n.n;o.setNodeMarkup(o.mapping.map(l+1+n.pos),null,v(r,r.colspan-n.n,n.n))}else if("missing"==n.type)a[n.row]+=n.n;else if("overlong_rowspan"==n.type){let e=t.nodeAt(n.pos);if(!e)continue;o.setNodeMarkup(o.mapping.map(l+1+n.pos),null,{...e.attrs,rowspan:e.attrs.rowspan-n.n})}else if("colwidth mismatch"==n.type){let e=t.nodeAt(n.pos);if(!e)continue;o.setNodeMarkup(o.mapping.map(l+1+n.pos),null,{...e.attrs,colwidth:n.colwidth})}}for(let e=0;e<a.length;e++)a[e]&&(null==n&&(n=e),r=e);for(let s=0,d=l+1;s<i.height;s++){let l=t.child(s),i=d+l.nodeSize,c=a[s];if(c>0){let t="cell";l.firstChild&&(t=l.firstChild.type.spec.tableRole);let a=[];for(let l=0;l<c;l++){let l=h(e.schema)[t].createAndFill();l&&a.push(l)}let p=(0==s||n==s-1)&&r==s?d+1:i-1;o.insert(o.mapping.map(p),a)}d=i}return o.setMeta(M,{fixTables:!0})}(e,t,o,l))};return t?t.doc!=e.doc&&!function e(t,l,o,n){let r=t.childCount,i=l.childCount;e:for(let a=0,s=0;a<i;a++){let i=l.child(a);for(let e=s,l=Math.min(r,a+3);e<l;e++)if(t.child(e)==i){s=e+1,o+=i.nodeSize;continue e}n(i,o),s<r&&t.child(s).sameMarkup(i)?e(t.child(s),i,o+1,n):i.nodesBetween(0,i.content.size,n,o+1),o+=i.nodeSize}}(t.doc,e.doc,0,o):e.doc.descendants(o),l}function R(e){let t=e.selection,l=g(e),o=l.node(-1),n=l.start(-1),r=p.get(o);return{...t instanceof A?r.rectBetween(t.$anchorCell.pos-n,t.$headCell.pos-n):r.findCell(l.pos-n),tableStart:n,map:r,table:o}}function N(e,{map:t,tableStart:l,table:o},n){let r=n>0?-1:0;(function(e,t,l){let o=h(t.type.schema).header_cell;for(let n=0;n<e.height;n++)if(t.nodeAt(e.map[l+n*e.width]).type!=o)return!1;return!0})(t,o,n+r)&&(r=0==n||n==t.width?null:0);for(let i=0;i<t.height;i++){let a=i*t.width+n;if(n>0&&n<t.width&&t.map[a-1]==t.map[a]){let r=t.map[a],s=o.nodeAt(r);e.setNodeMarkup(e.mapping.map(l+r),null,y(s.attrs,n-t.colCount(r))),i+=s.attrs.rowspan-1}else{let s=null==r?h(o.type.schema).cell:o.nodeAt(t.map[a+r]).type,d=t.positionAt(i,n,o);e.insert(e.mapping.map(l+d),s.createAndFill())}}return e}function H(e,{map:t,tableStart:l,table:o},n){var r;let i=l;for(let e=0;e<n;e++)i+=o.child(e).nodeSize;let a=[],s=n>0?-1:0;(function(e,t,l){var o;let n=h(t.type.schema).header_cell;for(let r=0;r<e.width;r++)if((null==(o=t.nodeAt(e.map[r+l*e.width]))?void 0:o.type)!=n)return!1;return!0})(t,o,n+s)&&(s=0==n||n==t.height?null:0);for(let i=0,d=t.width*n;i<t.width;i++,d++)if(n>0&&n<t.height&&t.map[d]==t.map[d-t.width]){let n=t.map[d],r=o.nodeAt(n).attrs;e.setNodeMarkup(l+n,null,{...r,rowspan:r.rowspan+1}),i+=r.colspan-1}else{let e=null==s?h(o.type.schema).cell:null==(r=o.nodeAt(t.map[d+s*t.width]))?void 0:r.type,l=null==e?void 0:e.createAndFill();l&&a.push(l)}return e.insert(i,h(o.type.schema).row.create(null,a)),e}function z(e){let t=e.content;return 1==t.childCount&&t.child(0).isTextblock&&0==t.child(0).childCount}function E(e,t){let l=e.selection;if(!(l instanceof A)||l.$anchorCell.pos==l.$headCell.pos)return!1;let o=R(e),{map:n}=o;if(function({width:e,height:t,map:l},o){let n=o.top*e+o.left,r=n,i=(o.bottom-1)*e+o.left,a=n+(o.right-o.left-1);for(let t=o.top;t<o.bottom;t++){if(o.left>0&&l[r]==l[r-1]||o.right<e&&l[a]==l[a+1])return!0;r+=e,a+=e}for(let r=o.left;r<o.right;r++){if(o.top>0&&l[n]==l[n-e]||o.bottom<t&&l[i]==l[i+e])return!0;n++,i++}return!1}(n,o))return!1;if(t){let l,r;let i=e.tr,s={},d=a.HY.empty;for(let e=o.top;e<o.bottom;e++)for(let t=o.left;t<o.right;t++){let a=n.map[e*n.width+t],c=o.table.nodeAt(a);if(!s[a]&&c){if(s[a]=!0,null==l)l=a,r=c;else{!z(c)&&(d=d.append(c.content));let e=i.mapping.map(a+o.tableStart);i.delete(e,e+c.nodeSize)}}}if(null==l||null==r)return!0;if(i.setNodeMarkup(l+o.tableStart,null,{...y(r.attrs,r.attrs.colspan,o.right-o.left-r.attrs.colspan),rowspan:o.bottom-o.top}),d.size){let e=l+1+r.content.size,t=z(r)?l+1:e;i.replaceWith(t+o.tableStart,e+o.tableStart,d)}i.setSelection(new A(i.doc.resolve(l+o.tableStart))),t(i)}return!0}function T(e,t){let l=h(e.schema);return(function(e){return(t,l)=>{var o;let n,r;let i=t.selection;if(i instanceof A){if(i.$anchorCell.pos!=i.$headCell.pos)return!1;n=i.$anchorCell.nodeAfter,r=i.$anchorCell.pos}else{if(!(n=function(e){for(let t=e.depth;t>0;t--){let l=e.node(t).type.spec.tableRole;if("cell"===l||"header_cell"===l)return e.node(t)}return null}(i.$from)))return!1;r=null==(o=f(i.$from))?void 0:o.pos}if(null==n||null==r||1==n.attrs.colspan&&1==n.attrs.rowspan)return!1;if(l){let o,a=n.attrs,s=[],d=a.colwidth;a.rowspan>1&&(a={...a,rowspan:1}),a.colspan>1&&(a={...a,colspan:1});let c=R(t),p=t.tr;for(let e=0;e<c.right-c.left;e++)s.push(d?{...a,colwidth:d&&d[e]?[d[e]]:null}:a);for(let t=c.top;t<c.bottom;t++){let l=c.map.positionAt(t,c.left,c.table);t==c.top&&(l+=n.nodeSize);for(let r=c.left,i=0;r<c.right;r++,i++)(r!=c.left||t!=c.top)&&p.insert(o=p.mapping.map(l+c.tableStart,1),e({node:n,row:t,col:r}).createAndFill(s[i]))}p.setNodeMarkup(r,e({node:n,row:c.top,col:c.left}),s[0]),i instanceof A&&p.setSelection(new A(p.doc.resolve(i.$anchorCell.pos),o?p.doc.resolve(o):void 0)),l(p)}return!0}})(({node:e})=>l[e.type.spec.tableRole])(e,t)}function k(e,t,l){let o=t.map.cellsInRect({left:0,top:0,right:"row"==e?t.map.width:1,bottom:"column"==e?t.map.height:1});for(let e=0;e<o.length;e++){let n=t.table.nodeAt(o[e]);if(n&&n.type!==l.header_cell)return!1}return!0}function _(e,t){if((t=t||{useDeprecatedLogic:!1}).useDeprecatedLogic){var l;return l=e,function(e,t){if(!m(e))return!1;if(t){let o=h(e.schema),n=R(e),r=e.tr,i=n.map.cellsInRect("column"==l?{left:n.left,top:0,right:n.right,bottom:n.map.height}:"row"==l?{left:0,top:n.top,right:n.map.width,bottom:n.bottom}:n),a=i.map(e=>n.table.nodeAt(e));for(let e=0;e<i.length;e++)a[e].type==o.header_cell&&r.setNodeMarkup(n.tableStart+i[e],o.cell,a[e].attrs);if(0==r.steps.length)for(let e=0;e<i.length;e++)r.setNodeMarkup(n.tableStart+i[e],o.header_cell,a[e].attrs);t(r)}return!0}}return function(t,l){if(!m(t))return!1;if(l){let o=h(t.schema),n=R(t),r=t.tr,i=k("row",n,o),a=k("column",n,o),s=("column"===e?i:"row"===e&&a)?1:0,d="column"==e?{left:0,top:s,right:1,bottom:n.map.height}:"row"==e?{left:s,top:0,right:n.map.width,bottom:1}:n,c="column"==e?a?o.cell:o.header_cell:"row"==e?i?o.cell:o.header_cell:o.cell;n.map.cellsInRect(d).forEach(e=>{let t=e+n.tableStart,l=r.doc.nodeAt(t);l&&r.setNodeMarkup(t,c,l.attrs)}),l(r)}return!0}}_("row",{useDeprecatedLogic:!0}),_("column",{useDeprecatedLogic:!0});var L=_("cell",{useDeprecatedLogic:!0});function B(e){return function(t,l){if(!m(t))return!1;let o=function(e,t){if(t<0){let t=e.nodeBefore;if(t)return e.pos-t.nodeSize;for(let t=e.index(-1)-1,l=e.before();t>=0;t--){let o=e.node(-1).child(t),n=o.lastChild;if(n)return l-1-n.nodeSize;l-=o.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;let t=e.node(-1);for(let l=e.indexAfter(-1),o=e.after();l<t.childCount;l++){let e=t.child(l);if(e.childCount)return o+1;o+=e.nodeSize}}return null}(g(t),e);if(null==o)return!1;if(l){var n;let e=t.doc.resolve(o);l(t.tr.setSelection(i.Bs.between(e,(n=e).node(0).resolve(n.pos+n.nodeAfter.nodeSize))).scrollIntoView())}return!0}}function W(e,t){let l=e.selection;if(!(l instanceof A))return!1;if(t){let o=e.tr,n=h(e.schema).cell.createAndFill().content;l.forEachCell((e,t)=>{!e.content.eq(n)&&o.replace(o.mapping.map(t+1),o.mapping.map(t+e.nodeSize-1),new a.p2(n,0,0))}),o.docChanged&&t(o)}return!0}function D(e,t){let l=e.createAndFill();return new c.wx(l).replace(0,l.content.size,t).doc}function Y(e,t,l,o,n,r,i,a){if(0==i||i==t.height)return!1;let s=!1;for(let d=n;d<r;d++){let n=i*t.width+d,r=t.map[n];if(t.map[n-t.width]==r){s=!0;let n=l.nodeAt(r),{top:c,left:p}=t.findCell(r);e.setNodeMarkup(e.mapping.slice(a).map(r+o),null,{...n.attrs,rowspan:i-c}),e.insert(e.mapping.slice(a).map(t.positionAt(i,p,l)),n.type.createAndFill({...n.attrs,rowspan:c+n.attrs.rowspan-i})),d+=n.attrs.colspan-1}}return s}function F(e,t,l,o,n,r,i,a){if(0==i||i==t.width)return!1;let s=!1;for(let d=n;d<r;d++){let n=d*t.width+i,r=t.map[n];if(t.map[n-1]==r){s=!0;let n=l.nodeAt(r),c=t.colCount(r),p=e.mapping.slice(a).map(r+o);e.setNodeMarkup(p,null,v(n.attrs,i-c,n.attrs.colspan-(i-c))),e.insert(p+n.nodeSize,n.type.createAndFill(v(n.attrs,0,i-c))),d+=n.attrs.rowspan-1}}return s}function j(e,t,l,o,n){let r=l?e.doc.nodeAt(l-1):e.doc;if(!r)throw Error("No table found");let i=p.get(r),{top:s,left:d}=o,c=d+n.width,u=s+n.height,f=e.tr,m=0;function g(){if(!(r=l?f.doc.nodeAt(l-1):f.doc))throw Error("No table found");i=p.get(r),m=f.mapping.maps.length}(function(e,t,l,o,n,r,i){let s,d;let c=h(e.doc.type.schema);if(n>t.width)for(let r=0,a=0;r<t.height;r++){let p;let h=l.child(r);a+=h.nodeSize;let u=[];p=null==h.lastChild||h.lastChild.type==c.cell?s||(s=c.cell.createAndFill()):d||(d=c.header_cell.createAndFill());for(let e=t.width;e<n;e++)u.push(p);e.insert(e.mapping.slice(i).map(a-1+o),u)}if(r>t.height){let p=[];for(let e=0,o=(t.height-1)*t.width;e<Math.max(t.width,n);e++){let n=!(e>=t.width)&&l.nodeAt(t.map[o+e]).type==c.header_cell;p.push(n?d||(d=c.header_cell.createAndFill()):s||(s=c.cell.createAndFill()))}let h=c.row.create(null,a.HY.from(p)),u=[];for(let e=t.height;e<r;e++)u.push(h);e.insert(e.mapping.slice(i).map(o+l.nodeSize-2),u)}return!!(s||d)})(f,i,r,l,c,u,0)&&g(),Y(f,i,r,l,d,c,s,m)&&g(),Y(f,i,r,l,d,c,u,m)&&g(),F(f,i,r,l,s,u,d,m)&&g(),F(f,i,r,l,s,u,c,m)&&g();for(let e=s;e<u;e++){let t=i.positionAt(e,d,r),o=i.positionAt(e,c,r);f.replace(f.mapping.slice(m).map(t+l),f.mapping.slice(m).map(o+l),new a.p2(n.rows[e-s],0,0))}g(),f.setSelection(new A(f.doc.resolve(l+i.positionAt(s,d,r)),f.doc.resolve(l+i.positionAt(u-1,c-1,r)))),t(f)}var O=(0,d.$)({ArrowLeft:P("horiz",-1),ArrowRight:P("horiz",1),ArrowUp:P("vert",-1),ArrowDown:P("vert",1),"Shift-ArrowLeft":V("horiz",-1),"Shift-ArrowRight":V("horiz",1),"Shift-ArrowUp":V("vert",-1),"Shift-ArrowDown":V("vert",1),Backspace:W,"Mod-Backspace":W,Delete:W,"Mod-Delete":W});function I(e,t,l){return!l.eq(e.selection)&&(t&&t(e.tr.setSelection(l).scrollIntoView()),!0)}function P(e,t){return(l,o,n)=>{if(!n)return!1;let r=l.selection;if(r instanceof A)return I(l,o,i.Y1.near(r.$headCell,t));if("horiz"!=e&&!r.empty)return!1;let a=K(n,e,t);if(null==a)return!1;if("horiz"==e)return I(l,o,i.Y1.near(l.doc.resolve(r.head+t),t));{let n;let r=l.doc.resolve(a),s=C(r,e,t);return n=s?i.Y1.near(s,1):t<0?i.Y1.near(l.doc.resolve(r.before(-1)),-1):i.Y1.near(l.doc.resolve(r.after(-1)),1),I(l,o,n)}}}function V(e,t){return(l,o,n)=>{let r;if(!n)return!1;let i=l.selection;if(i instanceof A)r=i;else{let o=K(n,e,t);if(null==o)return!1;r=new A(l.doc.resolve(o))}let a=C(r.$headCell,e,t);return!!a&&I(l,o,new A(r.$anchorCell,a))}}function X(e,t){let l=f(e.state.doc.resolve(t));return!!l&&(e.dispatch(e.state.tr.setSelection(new A(l))),!0)}function q(e,t,l){if(!m(e.state))return!1;let o=function(e){if(!e.size)return null;let{content:t,openStart:l,openEnd:o}=e;for(;1==t.childCount&&(l>0&&o>0||"table"==t.child(0).type.spec.tableRole);)l--,o--,t=t.child(0).content;let n=t.child(0),r=n.type.spec.tableRole,i=n.type.schema,s=[];if("row"==r)for(let e=0;e<t.childCount;e++){let n=t.child(e).content,r=e?0:Math.max(0,l-1),d=e<t.childCount-1?0:Math.max(0,o-1);(r||d)&&(n=D(h(i).row,new a.p2(n,r,d)).content),s.push(n)}else{if("cell"!=r&&"header_cell"!=r)return null;s.push(l||o?D(h(i).row,new a.p2(t,l,o)).content:t)}return function(e,t){let l=[];for(let e=0;e<t.length;e++){let o=t[e];for(let t=o.childCount-1;t>=0;t--){let{rowspan:n,colspan:r}=o.child(t).attrs;for(let t=e;t<e+n;t++)l[t]=(l[t]||0)+r}}let o=0;for(let e=0;e<l.length;e++)o=Math.max(o,l[e]);for(let n=0;n<l.length;n++)if(n>=t.length&&t.push(a.HY.empty),l[n]<o){let r=h(e).cell.createAndFill(),i=[];for(let e=l[n];e<o;e++)i.push(r);t[n]=t[n].append(a.HY.from(i))}return{height:t.length,width:o,rows:t}}(i,s)}(l),n=e.state.selection;if(n instanceof A){!o&&(o={width:1,height:1,rows:[a.HY.from(D(h(e.state.schema).cell,l))]});let t=n.$anchorCell.node(-1),r=n.$anchorCell.start(-1),i=p.get(t).rectBetween(n.$anchorCell.pos-r,n.$headCell.pos-r);return o=function({width:e,height:t,rows:l},o,n){if(e!=o){let t=[],n=[];for(let e=0;e<l.length;e++){let r=l[e],i=[];for(let l=t[e]||0,n=0;l<o;n++){let a=r.child(n%r.childCount);l+a.attrs.colspan>o&&(a=a.type.createChecked(v(a.attrs,a.attrs.colspan,l+a.attrs.colspan-o),a.content)),i.push(a),l+=a.attrs.colspan;for(let l=1;l<a.attrs.rowspan;l++)t[e+l]=(t[e+l]||0)+a.attrs.colspan}n.push(a.HY.from(i))}l=n,e=o}if(t!=n){let e=[];for(let o=0,r=0;o<n;o++,r++){let i=[],s=l[r%t];for(let e=0;e<s.childCount;e++){let t=s.child(e);o+t.attrs.rowspan>n&&(t=t.type.create({...t.attrs,rowspan:Math.max(1,n-t.attrs.rowspan)},t.content)),i.push(t)}e.push(a.HY.from(i))}l=e,t=n}return{width:e,height:t,rows:l}}(o,i.right-i.left,i.bottom-i.top),j(e.state,e.dispatch,r,i,o),!0}if(!o)return!1;{let t=g(e.state),l=t.start(-1);return j(e.state,e.dispatch,l,p.get(t.node(-1)).findCell(t.pos-l),o),!0}}function U(e,t){var l;let o;if(t.ctrlKey||t.metaKey)return;let n=J(e,t.target);if(t.shiftKey&&e.state.selection instanceof A)r(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&n&&null!=(o=f(e.state.selection.$anchor))&&(null==(l=G(e,t))?void 0:l.pos)!=o.pos)r(o,t),t.preventDefault();else if(!n)return;function r(t,l){let o=G(e,l),n=null==u.getState(e.state);if(!o||!b(t,o)){if(!n)return;o=t}let r=new A(t,o);if(n||!e.state.selection.eq(r)){let l=e.state.tr.setSelection(r);n&&l.setMeta(u,t.pos),e.dispatch(l)}}function i(){e.root.removeEventListener("mouseup",i),e.root.removeEventListener("dragstart",i),e.root.removeEventListener("mousemove",a),null!=u.getState(e.state)&&e.dispatch(e.state.tr.setMeta(u,-1))}function a(l){let o;let a=u.getState(e.state);if(null!=a)o=e.state.doc.resolve(a);else if(J(e,l.target)!=n&&!(o=G(e,t)))return i();o&&r(o,l)}e.root.addEventListener("mouseup",i),e.root.addEventListener("dragstart",i),e.root.addEventListener("mousemove",a)}function K(e,t,l){if(!(e.state.selection instanceof i.Bs))return null;let{$head:o}=e.state.selection;for(let n=o.depth-1;n>=0;n--){let r=o.node(n);if((l<0?o.index(n):o.indexAfter(n))!=(l<0?0:r.childCount))break;if("cell"==r.type.spec.tableRole||"header_cell"==r.type.spec.tableRole){let r=o.before(n),i="vert"==t?l>0?"down":"up":l>0?"right":"left";return e.endOfTextblock(i)?r:null}}return null}function J(e,t){for(;t&&t!=e.dom;t=t.parentNode)if("TD"==t.nodeName||"TH"==t.nodeName)return t;return null}function G(e,t){let l=e.posAtCoords({left:t.clientX,top:t.clientY});return l?l?f(e.state.doc.resolve(l.pos)):null:null}var Q=class{constructor(e,t){this.node=e,this.defaultCellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${t}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Z(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type==this.node.type&&(this.node=e,Z(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return"attributes"==e.type&&(e.target==this.table||this.colgroup.contains(e.target))}};function Z(e,t,l,o,n,r){var i;let a=0,s=!0,d=t.firstChild,c=e.firstChild;if(c){for(let e=0,l=0;e<c.childCount;e++){let{colspan:i,colwidth:p}=c.child(e).attrs;for(let e=0;e<i;e++,l++){let i=n==l?r:p&&p[e],c=i?i+"px":"";if(a+=i||o,!i&&(s=!1),d)d.style.width!=c&&(d.style.width=c),d=d.nextSibling;else{let e=document.createElement("col");e.style.width=c,t.appendChild(e)}}}for(;d;){let e=d.nextSibling;null==(i=d.parentNode)||i.removeChild(d),d=e}s?(l.style.width=a+"px",l.style.minWidth=""):(l.style.width="",l.style.minWidth=a+"px")}}var ee=new i.H$("tableColumnResizing"),et=class e{constructor(e,t){this.activeHandle=e,this.dragging=t}apply(t){let l=t.getMeta(ee);if(l&&null!=l.setHandle)return new e(l.setHandle,!1);if(l&&void 0!==l.setDragging)return new e(this.activeHandle,l.setDragging);if(this.activeHandle>-1&&t.docChanged){let l=t.mapping.map(this.activeHandle,-1);return!w(t.doc.resolve(l))&&(l=-1),new e(l,this.dragging)}return this}};function el(e,t,l,o){let n=e.posAtCoords({left:t.clientX+("right"==l?-o:o),top:t.clientY});if(!n)return -1;let{pos:r}=n,i=f(e.state.doc.resolve(r));if(!i)return -1;if("right"==l)return i.pos;let a=p.get(i.node(-1)),s=i.start(-1),d=a.map.indexOf(i.pos-s);return d%a.width==0?-1:s+a.map[d-1]}function eo(e,t,l){let o=t.clientX-e.startX;return Math.max(l,e.startWidth+o)}function en(e,t){e.dispatch(e.state.tr.setMeta(ee,{setHandle:t}))}function er(e,t,l,o){let n=e.state.doc.resolve(t),r=n.node(-1),i=n.start(-1),a=p.get(r).colCount(n.pos-i)+n.nodeAfter.attrs.colspan-1,s=e.domAtPos(n.start(-1)).node;for(;s&&"TABLE"!=s.nodeName;)s=s.parentNode;s&&Z(r,s.firstChild,s,o,a,l)}function ei(e,t){return t?["width",`${Math.max(t,e)}px`]:["min-width",`${e}px`]}function ea(e,t,l,o,n,r){var i;let a=0,s=!0,d=t.firstChild,c=e.firstChild;if(null!==c)for(let e=0,l=0;e<c.childCount;e+=1){let{colspan:i,colwidth:p}=c.child(e).attrs;for(let e=0;e<i;e+=1,l+=1){let i=n===l?r:p&&p[e],c=i?`${i}px`:"";if(a+=i||o,!i&&(s=!1),d){if(d.style.width!==c){let[e,t]=ei(o,i);d.style.setProperty(e,t)}d=d.nextSibling}else{let e=document.createElement("col"),[l,n]=ei(o,i);e.style.setProperty(l,n),t.appendChild(e)}}}for(;d;){let e=d.nextSibling;null===(i=d.parentNode)||void 0===i||i.removeChild(d),d=e}s?(l.style.width=`${a}px`,l.style.minWidth=""):(l.style.width="",l.style.minWidth=`${a}px`)}class es{constructor(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ea(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type===this.node.type&&(this.node=e,ea(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return"attributes"===e.type&&(e.target===this.table||this.colgroup.contains(e.target))}}function ed(e,t){return t?e.createChecked(null,t):e.createAndFill()}let ec=({editor:e})=>{let{selection:t}=e.state;if(!(t instanceof A))return!1;let l=0,o=(0,r.qv)(t.ranges[0].$from,e=>"table"===e.type.name);return null==o||o.node.descendants(e=>{if("table"===e.type.name)return!1;["tableCell","tableHeader"].includes(e.type.name)&&(l+=1)}),l===t.ranges.length&&(e.commands.deleteTable(),!0)},ep=r.NB.create({name:"table",addOptions:()=>({HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:es,lastColumnResizable:!0,allowTableNodeSelection:!1}),content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML:()=>[{tag:"table"}],renderHTML({node:e,HTMLAttributes:t}){let{colgroup:l,tableWidth:o,tableMinWidth:n}=function(e,t,l,o){let n=0,r=!0,i=[],a=e.firstChild;if(!a)return{};for(let e=0,l=0;e<a.childCount;e+=1){let{colspan:o,colwidth:s}=a.child(e).attrs;for(let e=0;e<o;e+=1,l+=1){let o=void 0===l?void 0:s&&s[e];n+=o||t,!o&&(r=!1);let[a,d]=ei(t,o);i.push(["col",{style:`${a}: ${d}`}])}}let s=r?`${n}px`:"";return{colgroup:["colgroup",{},...i],tableWidth:s,tableMinWidth:r?"":`${n}px`}}(e,this.options.cellMinWidth);return["table",(0,r.P1)(this.options.HTMLAttributes,t,{style:o?`width: ${o}`:`min-width: ${n}`}),l,["tbody",0]]},addCommands:()=>({insertTable:({rows:e=3,cols:t=3,withHeaderRow:l=!0}={})=>({tr:o,dispatch:n,editor:r})=>{let a=function(e,t,l,o,n){let r=function(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;let t={};return Object.keys(e.nodes).forEach(l=>{let o=e.nodes[l];o.spec.tableRole&&(t[o.spec.tableRole]=o)}),e.cached.tableNodeTypes=t,t}(e),i=[],a=[];for(let e=0;e<l;e+=1){let e=ed(r.cell,void 0);if(e&&a.push(e),o){let e=ed(r.header_cell,n);e&&i.push(e)}}let s=[];for(let e=0;e<t;e+=1)s.push(r.row.createChecked(null,o&&0===e?i:a));return r.table.createChecked(null,s)}(r.schema,e,t,l);if(n){let e=o.selection.from+1;o.replaceSelectionWith(a).scrollIntoView().setSelection(i.Bs.near(o.doc.resolve(e)))}return!0},addColumnBefore:()=>({state:e,dispatch:t})=>(function(e,t){if(!m(e))return!1;if(t){let l=R(e);t(N(e.tr,l,l.left))}return!0})(e,t),addColumnAfter:()=>({state:e,dispatch:t})=>(function(e,t){if(!m(e))return!1;if(t){let l=R(e);t(N(e.tr,l,l.right))}return!0})(e,t),deleteColumn:()=>({state:e,dispatch:t})=>(function(e,t){if(!m(e))return!1;if(t){let l=R(e),o=e.tr;if(0==l.left&&l.right==l.map.width)return!1;for(let e=l.right-1;!function(e,{map:t,table:l,tableStart:o},n){let r=e.mapping.maps.length;for(let i=0;i<t.height;){let a=i*t.width+n,s=t.map[a],d=l.nodeAt(s),c=d.attrs;if(n>0&&t.map[a-1]==s||n<t.width-1&&t.map[a+1]==s)e.setNodeMarkup(e.mapping.slice(r).map(o+s),null,v(c,n-t.colCount(s)));else{let t=e.mapping.slice(r).map(o+s);e.delete(t,t+d.nodeSize)}i+=c.rowspan}}(o,l,e),e!=l.left;e--){;let e=l.tableStart?o.doc.nodeAt(l.tableStart-1):o.doc;if(!e)throw RangeError("No table found");l.table=e,l.map=p.get(e)}t(o)}return!0})(e,t),addRowBefore:()=>({state:e,dispatch:t})=>(function(e,t){if(!m(e))return!1;if(t){let l=R(e);t(H(e.tr,l,l.top))}return!0})(e,t),addRowAfter:()=>({state:e,dispatch:t})=>(function(e,t){if(!m(e))return!1;if(t){let l=R(e);t(H(e.tr,l,l.bottom))}return!0})(e,t),deleteRow:()=>({state:e,dispatch:t})=>(function(e,t){if(!m(e))return!1;if(t){let l=R(e),o=e.tr;if(0==l.top&&l.bottom==l.map.height)return!1;for(let e=l.bottom-1;!function(e,{map:t,table:l,tableStart:o},n){let r=0;for(let e=0;e<n;e++)r+=l.child(e).nodeSize;let i=r+l.child(n).nodeSize,a=e.mapping.maps.length;e.delete(r+o,i+o);let s=new Set;for(let r=0,i=n*t.width;r<t.width;r++,i++){let d=t.map[i];if(!s.has(d)){if(s.add(d),n>0&&d==t.map[i-t.width]){let t=l.nodeAt(d).attrs;e.setNodeMarkup(e.mapping.slice(a).map(d+o),null,{...t,rowspan:t.rowspan-1}),r+=t.colspan-1}else if(n<t.height&&d==t.map[i+t.width]){let i=l.nodeAt(d),s=i.attrs,c=i.type.create({...s,rowspan:i.attrs.rowspan-1},i.content),p=t.positionAt(n+1,r,l);e.insert(e.mapping.slice(a).map(o+p),c),r+=s.colspan-1}}}}(o,l,e),e!=l.top;e--){;let e=l.tableStart?o.doc.nodeAt(l.tableStart-1):o.doc;if(!e)throw RangeError("No table found");l.table=e,l.map=p.get(l.table)}t(o)}return!0})(e,t),deleteTable:()=>({state:e,dispatch:t})=>(function(e,t){let l=e.selection.$anchor;for(let o=l.depth;o>0;o--)if("table"==l.node(o).type.spec.tableRole)return t&&t(e.tr.delete(l.before(o),l.after(o)).scrollIntoView()),!0;return!1})(e,t),mergeCells:()=>({state:e,dispatch:t})=>E(e,t),splitCell:()=>({state:e,dispatch:t})=>T(e,t),toggleHeaderColumn:()=>({state:e,dispatch:t})=>_("column")(e,t),toggleHeaderRow:()=>({state:e,dispatch:t})=>_("row")(e,t),toggleHeaderCell:()=>({state:e,dispatch:t})=>L(e,t),mergeOrSplit:()=>({state:e,dispatch:t})=>!!E(e,t)||T(e,t),setCellAttribute:(e,t)=>({state:l,dispatch:o})=>{var n,r;return(n=e,r=t,function(e,t){if(!m(e))return!1;let l=g(e);if(l.nodeAfter.attrs[n]===r)return!1;if(t){let o=e.tr;e.selection instanceof A?e.selection.forEachCell((e,t)=>{e.attrs[n]!==r&&o.setNodeMarkup(t,null,{...e.attrs,[n]:r})}):o.setNodeMarkup(l.pos,null,{...l.nodeAfter.attrs,[n]:r}),t(o)}return!0})(l,o)},goToNextCell:()=>({state:e,dispatch:t})=>B(1)(e,t),goToPreviousCell:()=>({state:e,dispatch:t})=>B(-1)(e,t),fixTables:()=>({state:e,dispatch:t})=>(t&&x(e),!0),setCellSelection:e=>({tr:t,dispatch:l})=>{if(l){let l=A.create(t.doc,e.anchorCell,e.headCell);t.setSelection(l)}return!0}}),addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:ec,"Mod-Backspace":ec,Delete:ec,"Mod-Delete":ec}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[function({handleWidth:e=5,cellMinWidth:t=25,defaultCellMinWidth:l=100,View:o=Q,lastColumnResizable:n=!0}={}){let r=new i.Sy({key:ee,state:{init(e,t){var n,i;let a=null==(i=null==(n=r.spec)?void 0:n.props)?void 0:i.nodeViews,s=h(t.schema).table.name;return o&&a&&(a[s]=(e,t)=>new o(e,l,t)),new et(-1,!1)},apply:(e,t)=>t.apply(e)},props:{attributes:e=>{let t=ee.getState(e);return t&&t.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(t,l)=>{(function(e,t,l,o){let n=ee.getState(e.state);if(n&&!n.dragging){let r=function(e){for(;e&&"TD"!=e.nodeName&&"TH"!=e.nodeName;)e=e.classList&&e.classList.contains("ProseMirror")?null:e.parentNode;return e}(t.target),i=-1;if(r){let{left:o,right:n}=r.getBoundingClientRect();t.clientX-o<=l?i=el(e,t,"left",l):n-t.clientX<=l&&(i=el(e,t,"right",l))}if(i!=n.activeHandle){if(!o&&-1!==i){let t=e.state.doc.resolve(i),l=t.node(-1),o=p.get(l),n=t.start(-1);if(o.colCount(t.pos-n)+t.nodeAfter.attrs.colspan-1==o.width-1)return}en(e,i)}}})(t,l,e,n)},mouseleave:e=>{(function(e){let t=ee.getState(e.state);t&&t.activeHandle>-1&&!t.dragging&&en(e,-1)})(e)},mousedown:(e,o)=>{(function(e,t,l,o){var n;let r=null!=(n=e.dom.ownerDocument.defaultView)?n:window,i=ee.getState(e.state);if(!i||-1==i.activeHandle||i.dragging)return;let a=e.state.doc.nodeAt(i.activeHandle),s=function(e,t,{colspan:l,colwidth:o}){let n=o&&o[o.length-1];if(n)return n;let r=e.domAtPos(t),i=r.node.childNodes[r.offset].offsetWidth,a=l;if(o)for(let e=0;e<l;e++)o[e]&&(i-=o[e],a--);return i/a}(e,i.activeHandle,a.attrs);function d(t){r.removeEventListener("mouseup",d),r.removeEventListener("mousemove",c);let o=ee.getState(e.state);(null==o?void 0:o.dragging)&&(function(e,t,l){let o=e.state.doc.resolve(t),n=o.node(-1),r=p.get(n),i=o.start(-1),a=r.colCount(o.pos-i)+o.nodeAfter.attrs.colspan-1,s=e.state.tr;for(let e=0;e<r.height;e++){let t=e*r.width+a;if(e&&r.map[t]==r.map[t-r.width])continue;let o=r.map[t],d=n.nodeAt(o).attrs,c=1==d.colspan?0:a-r.colCount(o);if(d.colwidth&&d.colwidth[c]==l)continue;let p=d.colwidth?d.colwidth.slice():function(e){return Array(e).fill(0)}(d.colspan);p[c]=l,s.setNodeMarkup(i+o,null,{...d,colwidth:p})}s.docChanged&&e.dispatch(s)}(e,o.activeHandle,eo(o.dragging,t,l)),e.dispatch(e.state.tr.setMeta(ee,{setDragging:null})))}function c(t){if(!t.which)return d(t);let n=ee.getState(e.state);if(n&&n.dragging){let r=eo(n.dragging,t,l);er(e,n.activeHandle,r,o)}}e.dispatch(e.state.tr.setMeta(ee,{setDragging:{startX:t.clientX,startWidth:s}})),er(e,i.activeHandle,s,o),r.addEventListener("mouseup",d),r.addEventListener("mousemove",c),t.preventDefault()})(e,o,t,l)}},decorations:e=>{let t=ee.getState(e);if(t&&t.activeHandle>-1)return function(e,t){var l;let o=[],n=e.doc.resolve(t),r=n.node(-1);if(!r)return s.EH.empty;let i=p.get(r),a=n.start(-1),d=i.colCount(n.pos-a)+n.nodeAfter.attrs.colspan-1;for(let t=0;t<i.height;t++){let n=d+t*i.width;if((d==i.width-1||i.map[n]!=i.map[n+1])&&(0==t||i.map[n]!=i.map[n-i.width])){let t=i.map[n],d=a+t+r.nodeAt(t).nodeSize-1,c=document.createElement("div");c.className="column-resize-handle",(null==(l=ee.getState(e))?void 0:l.dragging)&&o.push(s.p.node(a+t,a+t+r.nodeAt(t).nodeSize,{class:"column-resize-dragging"})),o.push(s.p.widget(d,c))}}return s.EH.create(e.doc,o)}(e,t.activeHandle)},nodeViews:{}}});return r}({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],function({allowTableNodeSelection:e=!1}={}){return new i.Sy({key:u,state:{init:()=>null,apply(e,t){let l=e.getMeta(u);if(null!=l)return -1==l?null:l;if(null==t||!e.docChanged)return t;let{deleted:o,pos:n}=e.mapping.mapResult(t);return o?null:n}},props:{decorations:$,handleDOMEvents:{mousedown:U},createSelectionBetween:e=>null!=u.getState(e.state)?e.state.selection:null,handleTripleClick:X,handleKeyDown:O,handlePaste:q},appendTransaction:(t,l,o)=>(function(e,t,l){let o,n;let r=(t||e).selection,a=(t||e).doc;if(r instanceof i.qv&&(n=r.node.type.spec.tableRole)){if("cell"==n||"header_cell"==n)o=A.create(a,r.from);else if("row"==n){let e=a.resolve(r.from+1);o=A.rowSelection(e,e)}else if(!l){let e=p.get(r.node),t=r.from+1,l=t+e.map[e.width*e.height-1];o=A.create(a,t+1,l)}}else r instanceof i.Bs&&function({$from:e,$to:t}){if(e.pos==t.pos||e.pos<t.pos-6)return!1;let l=e.pos,o=t.pos,n=e.depth;for(;n>=0&&!(e.after(n+1)<e.end(n));n--,l++);for(let e=t.depth;e>=0&&!(t.before(e+1)>t.start(e));e--,o--);return l==o&&/row|table/.test(e.node(n).type.spec.tableRole)}(r)?o=i.Bs.create(a,r.from):r instanceof i.Bs&&function({$from:e,$to:t}){let l,o;for(let t=e.depth;t>0;t--){let o=e.node(t);if("cell"===o.type.spec.tableRole||"header_cell"===o.type.spec.tableRole){l=o;break}}for(let e=t.depth;e>0;e--){let l=t.node(e);if("cell"===l.type.spec.tableRole||"header_cell"===l.type.spec.tableRole){o=l;break}}return l!==o&&0===t.parentOffset}(r)&&(o=i.Bs.create(a,r.$from.start(),r.$from.end()));return o&&(t||(t=e.tr)).setSelection(o),t})(o,x(o,l),e)})}({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(e){let t={name:e.name,options:e.options,storage:e.storage};return{tableRole:(0,r.nU)((0,r.Nl)(e,"tableRole",t))}}})}};